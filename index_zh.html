<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossZoneLLM - 跨区域大模型训练优化平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <style>
        @import url('fonts/Inter-Regular.ttf');
        @import url('fonts/Inter-Bold.ttf');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .data-card {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.2s;
        }
        
        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .data-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        
        .data-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
        }
        
        .data-unit {
            font-size: 0.875rem;
            font-weight: normal;
            color: #64748b;
        }
        
        .map-container {
            position: relative;
            height: 400px;
            background-color: #f1f5f9;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .region-node {
            position: absolute;
            background-color: #3b82f6;
            border-radius: 50%;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .region-node:hover {
            transform: scale(1.1);
        }
        
        .connection-line {
            position: absolute;
            background-color: #94a3b8;
            height: 2px;
            transform-origin: left center;
            z-index: 0;
        }
        
        .data-parallel {
            background-color: #3b82f6;
        }
        
        .pipeline-parallel {
            background-color: #10b981;
        }
        
        .tensor-parallel {
            background-color: #8b5cf6;
        }
        
        .distance-label {
            position: absolute;
            background-color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            color: #64748b;
            white-space: nowrap;
            z-index: 1;
        }
        
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background-color: #1e293b;
            color: white;
            display: flex;
            align-items: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            transition: all 0.3s;
            transform: translateY(20px);
            opacity: 0;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            max-width: 28rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        pre {
            background-color: #f1f5f9;
            border-radius: 0.375rem;
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
        
        .parallel-visual {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .strategy-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .strategy-toggle input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <div class="flex flex-wrap items-center justify-between">
                <h1 class="text-3xl font-bold text-gray-800 mb-4 sm:mb-0">CrossZoneLLM</h1>
                <p class="text-xl text-gray-600 mb-4 sm:mb-0">跨区域大模型训练优化平台</p>
                <div class="flex gap-4">
                    <button id="switchToEnBtn" class="px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                        英文
                    </button>
                    <button id="switchToZhBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-70 transition-colors">
                        中文
                    </button>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 配置区域 -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">训练配置</h2>
                    <form id="configForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2" for="regions">区域数量</label>
                            <input type="number" id="regions" name="regions" min="1" max="8" value="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div id="gpusPerRegionContainer">
                            <label class="block text-gray-700 font-medium mb-2">每区域GPU数量</label>
                            <div class="gpusPerRegionGroup">
                                <input type="number" class="gpusPerRegion w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" max="128" value="8">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2" for="modelSize">模型大小 (B)</label>
                            <input type="number" id="modelSize" name="modelSize" min="0.1" max="100" step="0.1" value="7" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2" for="batchSize">批量大小</label>
                            <input type="number" id="batchSize" name="batchSize" min="1" max="1024" value="64" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2" for="networkLatency">网络延迟 (ms)</label>
                            <input type="number" id="networkLatency" name="networkLatency" min="0.1" max="1000" step="0.1" value="50" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2" for="networkBandwidth">网络带宽 (Gbps)</label>
                            <input type="number" id="networkBandwidth" name="networkBandwidth" min="1" max="1000" step="0.1" value="10" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div id="distanceContainer" class="mt-4">
                            <label class="block text-gray-700 font-medium mb-2">区域间距离 (km)</label>
                            <div id="distanceInputs"></div>
                        </div>

                        <div class="flex gap-3 pt-2">
                            <button type="submit" id="calculateBtn" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                计算配置
                            </button>
                            <button type="button" id="deployBtn" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors">
                                部署到DeepSpeed
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 结果显示区域 -->
            <div class="lg:col-span-2">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex border-b border-gray-200 mb-4">
                        <button id="trainingMapTab" class="tab-button active mr-4" data-tab="trainingMap">
                            训练地图
                        </button>
                        <button id="parallelStrategyTab" class="tab-button mr-4" data-tab="parallelStrategy">
                            并行策略
                        </button>
                        <button id="communicationTab" class="tab-button mr-4" data-tab="communication">
                            通信分析
                        </button>
                        <button id="deploymentTab" class="tab-button" data-tab="deployment">
                            部署代码
                        </button>
                    </div>

                    <!-- 训练地图 -->
                    <div id="trainingMapContent" class="tab-content">
                        <div id="mapContainer" class="map-container mb-4">
                            <!-- 地图将在这里动态生成 -->
                        </div>
                    </div>

                    <!-- 并行策略 -->
                    <div id="parallelStrategyContent" class="tab-content hidden">
                        <div id="parallelStrategyResult" class="mb-4">
                            <p class="text-gray-600">请配置参数并点击"计算配置"按钮生成并行策略</p>
                        </div>
                        <div class="h-80">
                            <canvas id="parallelChart"></canvas>
                        </div>
                    </div>

                    <!-- 通信分析 -->
                    <div id="communicationContent" class="tab-content hidden">
                        <div id="communicationResult" class="mb-4">
                            <p class="text-gray-600">请配置参数并点击"计算配置"按钮生成通信分析</p>
                        </div>

                        <div class="mb-6">
                            <h4 class="font-medium mb-2 text-gray-800">通信策略配置</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                <div class="strategy-toggle">
                                    <input type="checkbox" id="gradientAccumulationToggle" checked>
                                    <label for="gradientAccumulationToggle">梯度累积</label>
                                </div>
                                <div class="strategy-toggle">
                                    <input type="checkbox" id="dataCompressionToggle" checked>
                                    <label for="dataCompressionToggle">数据压缩</label>
                                </div>
                                <div class="strategy-toggle">
                                    <input type="checkbox" id="predictiveCommunicationToggle" checked>
                                    <label for="predictiveCommunicationToggle">预测通信</label>
                                </div>
                                <div class="strategy-toggle">
                                    <input type="checkbox" id="asyncCommunicationToggle" checked>
                                    <label for="asyncCommunicationToggle">异步通信</label>
                                </div>
                                <div class="">
                                    <label for="crossRegionPrimitive" class="block mb-1">通信原语</label>
                                    <select id="crossRegionPrimitive" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                                        <option value="ring_allreduce">Ring-AllReduce</option>
                                        <option value="allreduce">AllReduce</option>
                                        <option value="broadcast">Broadcast</option>
                                    </select>
                                </div>
                                <div class="">
                                    <label for="chunkSize" class="block mb-1">块大小 (MB)</label>
                                    <input type="number" id="chunkSize" min="1" max="1024" value="256" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                                </div>
                                <div class="">
                                    <label for="overlapCoefficient" class="block mb-1">重叠系数</label>
                                    <input type="number" id="overlapCoefficient" min="0" max="1" step="0.1" value="0.7" class="w-full px-2 py-1 border border-gray-300 rounded-md text-sm">
                                </div>
                            </div>
                        </div>

                        <div id="communicationHidingResult" class="mb-4">
                            <p class="text-gray-600">请配置参数并点击"计算配置"按钮生成通信隐藏策略推荐</p>
                        </div>
                    </div>

                    <!-- 部署代码 -->
                    <div id="deploymentContent" class="tab-content hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-medium text-gray-800">DeepSpeed部署代码</h4>
                            <button id="copyCodeBtn" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors text-sm">
                                <i class="fa fa-copy mr-1"></i> 复制代码
                            </button>
                        </div>
                        <pre id="deploymentCode"># 请配置参数并点击"计算配置"按钮生成DeepSpeed部署代码</pre>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mt-8 text-center text-gray-600 text-sm">
            <p>© 2023 CrossZoneLLM - 跨区域大模型训练优化平台</p>
        </footer>
    </div>

    <!-- 部署确认模态框 -->
    <div id="deployModal" class="modal-overlay hidden">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">确认部署</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <p class="text-gray-600 mb-4">您确定要将当前配置部署到DeepSpeed吗？</p>
            <div class="flex justify-end gap-3">
                <button id="cancelDeploy" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                    取消
                </button>
                <button id="confirmDeploy" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                    确认部署
                </button>
            </div>
        </div>
    </div>

    <!-- 通知消息 -->
    <div id="notification" class="notification">
        <i id="notificationIcon" class="fa fa-info-circle mr-2"></i>
        <span id="notificationMessage"></span>
    </div>

    <script src="app.js"></script>
</body>
</html>